---
source: crates/cribo/tests/test_bundling_snapshots.rs
input_file: crates/cribo/tests/fixtures/conditional_imports/main.py
---
#!/usr/bin/env python3
# Generated by Cribo - Python Source Bundler
# https://github.com/ophidiarium/cribo

import functools
import sys
import types
@functools.cache
def __cribo_init___cribo_17f1ec_try_except_module():
    __cribo_module = types.SimpleNamespace()
    __cribo_module.__name__ = 'try_except_module'
    """Module with imports inside try/except blocks."""
    etree = None
    __cribo_module.etree = etree
    ETREE_VERSION = None
    __cribo_module.ETREE_VERSION = ETREE_VERSION
    try:
        from lxml import etree
        __cribo_module.etree = etree
        ETREE_VERSION = "lxml"
        __cribo_module.ETREE_VERSION = ETREE_VERSION
    except ImportError:
        try:
            import xml.etree.ElementTree as etree
            __cribo_module.etree = etree
            ETREE_VERSION = "stdlib"
            __cribo_module.ETREE_VERSION = ETREE_VERSION
        except ImportError:
            etree = None
            __cribo_module.etree = etree
            ETREE_VERSION = None
            __cribo_module.ETREE_VERSION = ETREE_VERSION
    parser_backend = None
    __cribo_module.parser_backend = parser_backend
    try:
        import cElementTree as ET
        __cribo_module.ET = ET
        parser_backend = "cElementTree"
        __cribo_module.parser_backend = parser_backend
    except ImportError:
        try:
            import xml.etree.ElementTree as ET
            __cribo_module.ET = ET
            parser_backend = "ElementTree"
            __cribo_module.parser_backend = parser_backend
        except ImportError:
            ET = None
            __cribo_module.ET = ET
            parser_backend = None
            __cribo_module.parser_backend = parser_backend

    def parse_xml(xml_string):
        """Parse XML using available parser."""
        if etree is not None:
            return __cribo_module.etree.fromstring(xml_string)
        elif ET is not None:
            return ET.fromstring(xml_string)
        else:
            raise ImportError("No XML parser available")
    __cribo_module.parse_xml = parse_xml
    return __cribo_module
@functools.cache
def __cribo_init___cribo_e43fad_conditional_module():
    __cribo_module = types.SimpleNamespace()
    __cribo_module.__name__ = 'conditional_module'
    """Module with conditional imports inside if/else blocks."""
    has_simplejson = False
    __cribo_module.has_simplejson = has_simplejson
    try:
        import simplejson as json
        __cribo_module.json = json
        has_simplejson = True
        __cribo_module.has_simplejson = has_simplejson
    except ImportError:
        import json
        __cribo_module.json = json
    if has_simplejson:
        from simplejson import JSONDecodeError
        __cribo_module.JSONDecodeError = JSONDecodeError
    else:
        from json import JSONDecodeError
        __cribo_module.JSONDecodeError = JSONDecodeError
    if sys.version_info[0] >= 3:
        builtin_str = str
        __cribo_module.builtin_str = builtin_str
        my_str = str
        __cribo_module.my_str = my_str
    else:
        builtin_str = str
        __cribo_module.builtin_str = builtin_str
        my_str = unicode
        __cribo_module.my_str = my_str
    basestring = str, bytes
    __cribo_module.basestring = basestring
    if has_simplejson:
        if hasattr(json, "JSONDecodeError"):
            pass
        else:
            JSONDecodeError = ValueError
            __cribo_module.JSONDecodeError = JSONDecodeError
    else:
        pass

    def decode_json(text):
        """Decode JSON using the conditionally imported decoder."""
        try:
            return json.loads(text)
        except JSONDecodeError as e:
            return None
    __cribo_module.decode_json = decode_json
    return __cribo_module
"""Test conditional imports in if/else and try/except blocks."""
conditional_module = __cribo_init___cribo_e43fad_conditional_module()
try_except_module = __cribo_init___cribo_17f1ec_try_except_module()
print("If/else import - JSONDecodeError:", hasattr(conditional_module, "JSONDecodeError"))
print("If/else import - json:", hasattr(conditional_module, "json"))
print("If/else import - builtin_str:", hasattr(conditional_module, "builtin_str"))
try:
    raise conditional_module.JSONDecodeError("test", "doc", 0)
except conditional_module.JSONDecodeError as e:
    print("Successfully caught JSONDecodeError from conditional import")
print("Try/except import - etree:", hasattr(try_except_module, "etree"))
print("Try/except import - ETREE_VERSION:", hasattr(try_except_module, "ETREE_VERSION"))
if try_except_module.etree is not None:
    print("Successfully imported etree module")
else:
    print("etree module is None (not available)")
expected_attrs = ["JSONDecodeError", "json", "builtin_str", "basestring", "has_simplejson"]
for attr in expected_attrs:
    if hasattr(conditional_module, attr):
        print(f"✓ {attr} is accessible")
    else:
        print(f"✗ {attr} is NOT accessible")
